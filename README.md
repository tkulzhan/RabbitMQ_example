# Система управления пользователями и Сервис истории действий

Это пример приложений на Node.js, созданных с использованием фреймворков NestJS и Express, которые демонстрируют систему управления пользователями и интеграцию с RabbitMQ для отслеживания действий, связанных с пользователями. Они также работают с базой данных PostgreSQL с использованием Prisma и TypeORM.

## Система управления пользователями

### Компоненты:

- **RabbitMQService**: Сервис, обеспечивающий подключение к серверу RabbitMQ и отправку сообщений в указанную очередь.

- **CreateUserDto**: Объект передачи данных (DTO) для создания нового пользователя с правилами валидации для имени пользователя, электронной почты, пароля, возраста и пола.

- **UpdateUserDto**: DTO для частичного обновления информации о пользователе.

- **User entity**: Класс сущности, представляющий информацию о пользователе, такую как имя пользователя, электронная почта, хешированный пароль, возраст и пол.

- **UserController**: Контроллер NestJS, обрабатывающий HTTP-запросы для управления пользователями, включая создание, чтение, обновление и удаление.

- **UserService**: Сервис, предоставляющий бизнес-логику для управления пользователями, а также интеграцию с RabbitMQ для отправки сообщений при действиях с пользователями.

### Настройка и запуск:

- Установите необходимые переменные среды, такие как настройки базы данных (DB_HOST, DB_PORT, DB_PASSWORD, DB_USERNAME, DB_NAME), URL RabbitMQ (AMQP_URL) и порт приложения (PORT).

- Установите необходимые зависимости с помощью `npm i`

- Запустите приложение с помощью `npm start`.

### API-конечные точки:

- `POST /user`: Создание нового пользователя.

- `GET /user`: Получение списка всех пользователей.

- `GET /user/:id`: Получение информации о пользователе по идентификатору.

- `PATCH /user/:id`: Обновление информации о пользователе.

- `DELETE /user/:id`: Удаление пользователя.

### Обработка ошибок:

Приложение обрабатывает различные виды ошибок, включая ошибки валидации, ошибки базы данных и внутренние ошибки сервера, возвращая клиенту соответствующие сообщения об ошибках.

## Сервис истории действий

### Компоненты:

- Этот сервис интегрируется с RabbitMQ для отслеживания действий, связанных с пользователями, и сохраняет их в базе данных Prisma в модели `history`.

- Предоставляет API-конечную точку для получения истории действий с параметрами, такими как номер страницы, количество записей на странице и сортировка.

### Настройка и запуск:

- Установите необходимые переменные среды, такие как настройки базы данных (DB_HOST, DB_PORT, DB_PASSWORD, DB_USERNAME, DB_NAME), URL RabbitMQ (AMQP_URL) и порт приложения (PORT).

- Установите необходимые зависимости с помощью `npm i`

- Запустите приложение с помощью `npm start`.

### Получение истории действий:

- Используйте API-конечную точку, например, выполните GET-запрос на `/history/page/1?limit=10&sort=desc&user=42`, чтобы получить историю на первой странице с 10 записями, отсортированными по убыванию даты создания пользователя с id 42.

### Обработка ошибок:

Сервис обрабатывает различные виды ошибок, включая ошибки валидации параметров запроса и внутренние ошибки сервера, возвращая клиенту соответствующие сообщения об ошибках.
